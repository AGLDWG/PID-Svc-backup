<VirtualHost *>
        #ServerName environment.data.gov.au

        ErrorLog ${APACHE_LOG_DIR}/environment.data.gov.au/error.log
        LogLevel alert rewrite:trace8
        CustomLog ${APACHE_LOG_DIR}/environment.data.gov.au/access.log combined

        RedirectMatch ^$ /environment
        RedirectMatch ^/$ /environment

        ProxyRequests Off
        ProxyPreserveHost On

        <Location "/environment">
                ProxyPass http://localhost:8080/environment keepalive=On
                ProxyPassReverse http://localhost:8080/environment
				
                # Auth
                Require user environment
                Order allow,deny
                Satisfy any
                AuthType Basic
                AuthName "PID Svc Admin users"
                AuthUserFile /etc/.htpasswd				
        </Location>

        RewriteEngine on
        RewriteCond %{REQUEST_URI} !/environment [NC]
        RewriteRule ^(/(?!pidsvc(?:$|/)|favicon\.ico|robots\.txt|manager(?:$|/)).+)$ http://localhost:8080/environment/dispatcher?$1 [NC,B,QSA,P,L]
</VirtualHost>
